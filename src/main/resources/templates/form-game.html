<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/head :: header}"></head>

<body>
    
    <div th:replace="~{fragments/nav :: navbar}"></div>

    <div class="container mt-5 mb-5">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-7"> 
                
                <div class="val-dashboard-card">
                    
                    <div class="text-center mb-4 border-bottom border-secondary pb-3">
                        <h2 class="fw-bold text-white text-uppercase" style="font-family: 'Kanit', sans-serif; letter-spacing: 2px;">
                            <i class="bi bi-disc-fill me-2 text-val-red"></i>
                            <span th:text="${game.id == null ? 'NUEVO JUEGO' : 'EDITAR JUEGO'}">TÍTULO</span>
                        </h2>
                        <p class="text-secondary small mb-0">SELECCIONA EL MÉTODO DE ENTRADA DE DATOS.</p>
                    </div>

                    <div class="d-flex justify-content-center gap-3 mb-4">
                        <button type="button" id="btn-mode-manual" class="btn val-tab-btn active w-50 fw-bold text-uppercase">
                            <i class="bi bi-keyboard me-2"></i> Manual
                        </button>
                        <button type="button" id="btn-mode-ai" class="btn val-tab-btn w-50 fw-bold text-uppercase"
                                th:if="${game.id == null}"> <i class="bi bi-robot me-2"></i> Escaneo IA
                        </button>
                    </div>
                    
                    <div id="section-manual" class="val-tab-content">
                        <form th:action="@{/games/save}" th:object="${game}" method="post" enctype="multipart/form-data">
                            
                            <input type="hidden" th:field="*{id}" />
                            <input type="hidden" th:field="*{coverImg}" />

                            <div class="mb-3">
                                <label class="text-secondary small fw-bold text-uppercase mb-1">Título del Juego</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-dark border-secondary text-secondary"><i class="bi bi-controller"></i></span>
                                    <input type="text" th:field="*{title}" class="form-control" placeholder="Ej: Super Mario World" th:errorclass="is-invalid"/>
                                </div>
                                <div class="invalid-feedback d-block text-danger small mt-1" th:if="${#fields.hasErrors('title')}" th:errors="*{title}">Error</div>
                            </div>

                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label class="text-secondary small fw-bold text-uppercase mb-1">Plataforma</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-dark border-secondary text-secondary"><i class="bi bi-hdd-rack"></i></span>
                                        <select th:field="*{console}" class="form-select" th:errorclass="is-invalid">
                                            <option th:each="c : ${consoles}" th:value="${c.id}" th:text="${c.name}">SNES</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <label class="text-secondary small fw-bold text-uppercase mb-1">Género</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-dark border-secondary text-secondary"><i class="bi bi-tags"></i></span>
                                        <select th:field="*{genre}" class="form-select" th:errorclass="is-invalid">
                                            <option value="" disabled selected>SELECCIONAR</option>
                                            <option value="Acción">ACCIÓN</option>
                                            <option value="Aventura">AVENTURA</option>
                                            <option value="RPG">RPG / ROL</option>
                                            <option value="Plataformas">PLATAFORMAS</option>
                                            <option value="Deportes">DEPORTES</option>
                                            <option value="Carreras">CARRERAS</option>
                                            <option value="Lucha">LUCHA</option>
                                            <option value="Estrategia">ESTRATEGIA</option>
                                            <option value="Terror">TERROR</option>
                                            <option value="Shooter">SHOOTER</option>
                                            <option value="Puzzle">PUZZLE</option>
                                            <option value="Simulación">SIMULACIÓN</option>
                                            <option value="Retro">ARCADE / RETRO</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="row g-3 mb-4">
                                <div class="col-md-4">
                                    <label class="text-secondary small fw-bold text-uppercase mb-1">Lanzamiento</label>
                                    <input type="date" th:field="*{launchDate}" class="form-control" />
                                </div>
                                <div class="col-md-4">
                                    <label class="text-secondary small fw-bold text-uppercase mb-1">Estado</label>
                                    <select th:field="*{status}" class="form-select">
                                        <option value="Pendiente">PENDIENTE</option>
                                        <option value="Jugando">JUGANDO</option>
                                        <option value="Completado">COMPLETADO</option>
                                        <option value="Abandonado">ABANDONADO</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="text-secondary small fw-bold text-uppercase mb-1">Nota (0-10)</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-dark border-secondary text-secondary"><i class="bi bi-star-fill"></i></span>
                                        <input type="number" th:field="*{rate}" class="form-control text-center fw-bold" min="0" max="10" step="1" placeholder="8" />
                                    </div>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label class="text-secondary small fw-bold text-uppercase mb-1">Portada (Imagen)</label>
                                <input type="file" name="file" class="form-control" accept="image/*" />
                                <div th:if="${game.coverImg != null}" class="mt-3 p-2 border border-secondary rounded bg-dark d-inline-block">
                                    <p class="small text-secondary mb-1">PORTADA ACTUAL:</p>
                                    <img th:src="@{'/uploads/' + ${game.coverImg}}" style="height: 100px; object-fit: cover;" class="rounded border border-secondary">
                                </div>
                            </div>

                            <div class="d-grid gap-2 pt-3 border-top border-secondary border-opacity-25">
                                <button type="submit" class="btn val-btn-register py-2 text-uppercase fw-bold" style="letter-spacing: 1px;">
                                    <i class="bi bi-save2-fill me-2"></i> Guardar Datos
                                </button>
                                <a th:href="@{/games}" class="btn btn-outline-secondary py-2 text-uppercase fw-bold text-white-50" style="letter-spacing: 1px;">
                                    Cancelar Misión
                                </a>
                            </div>
                        </form>
                    </div>

                    <div id="section-ai" class="val-tab-content" style="display: none;">
                        <div class="text-center py-5">
                            <div class="mb-4">
                                <i class="bi bi-robot text-val-red" style="font-size: 4rem;"></i>
                            </div>
                            <h4 class="text-white fw-bold mb-3">INTELIGENCIA ARTIFICIAL EN ESPERA</h4>
                            <p class="text-secondary px-4">
                                Sube una foto de la portada del videojuego. Nuestro escáner neuronal identificará el título, la plataforma y el año automáticamente.
                            </p>
                            
                            <div class="mt-4 p-4 border border-secondary border-dashed rounded bg-black bg-opacity-25">
                                <button class="btn btn-outline-light disabled">
                                    <i class="bi bi-cloud-upload me-2"></i> Próximamente...
                                </button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div th:replace="~{fragments/footer :: footer}"></div>
    
    <script th:src="@{/js/scripts.js}"></script> 
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>