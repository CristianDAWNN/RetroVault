<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: header}"></head>
<body>

    <div th:replace="~{fragments/nav :: navbar}"></div>

    <div class="container mt-5 mb-5">
        <div class="row justify-content-center">
            
            <div class="col-lg-7">
                <div class="card border-secondary shadow-lg overflow-hidden" style="background-color: #1a1a1a; border-color: rgba(255,255,255,0.1);">
                    
                    <div class="card-header border-0" style="background: linear-gradient(135deg, #111111 30%, #ff4655 100%); height: 120px;"></div>
                    
                    <div class="card-body position-relative pt-0 px-4">
                        
                        <div class="text-center" style="margin-top: -75px;">
                            
                            <div class="position-relative d-inline-block">
                                    <img th:if="${user.avatar != null}" th:src="${user.avatar}"
                                     class="rounded-circle border border-4 border-dark shadow-lg"
                                     style="width: 150px; height: 150px; object-fit: cover; background-color: #1a1a1a;">
                                     
                                <img th:if="${user.avatar == null}" src="https://cdn-icons-png.flaticon.com/512/847/847969.png" 
                                     class="rounded-circle border border-4 border-dark shadow-lg"
                                     style="width: 150px; height: 150px; object-fit: cover; background-color: #eee;">
                            </div>
                            
                            <h2 class="mt-3 fw-bold text-white text-uppercase" style="font-family: 'Kanit', sans-serif; letter-spacing: 1px;" th:text="${user.username}">USUARIO</h2>

                            <div class="d-flex flex-column align-items-center justify-content-center mt-2 mb-3">
                                <span class="badge bg-val-red text-white border border-secondary mb-2 text-uppercase" style="letter-spacing: 1px;">
                                    Nivel <span th:text="${user.level}">1</span>
                                </span>
                                
                                <div class="progress border border-secondary" style="width: 220px; height: 22px; background-color: #0a0a0a;">
                                    <div class="progress-bar progress-bar-striped progress-bar-animated bg-val-red" 
                                         role="progressbar" 
                                         th:style="'width: ' + ${user.getExpPercentage()} + '%; box-shadow: 0 0 15px rgba(255, 70, 85, 0.6);'"
                                         th:aria-valuenow="${user.experience}" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100">
                                         
                                         <span style="font-size: 0.7rem; font-weight: bold; text-shadow: 1px 1px 2px black;">
                                            <span th:text="${user.experience}">0</span> / <span th:text="${user.getXpToNextLevel()}">100</span> XP
                                         </span>
                                    </div>
                                </div>
                            </div>

                            <p class="text-secondary small mt-1 text-uppercase">
                                <i class="bi bi-calendar-check me-1"></i> Registrado el <span th:text="${#temporals.format(user.createdAt, 'dd/MM/yyyy')}">Fecha</span>
                            </p>
                        </div>

                        <div class="row text-center mt-4 mb-4 mx-2 p-3 rounded border border-secondary border-opacity-25" style="background-color: rgba(255,255,255,0.02);">
                            <div class="col-6 border-end border-secondary border-opacity-25">
                                <div class="text-secondary small fw-bold text-uppercase mb-1" style="letter-spacing: 1px;">Juegos</div>
                                <h3 class="fw-bold text-white display-5 mb-0" th:text="${gamesCount}">0</h3>
                            </div>
                            <div class="col-6">
                                <div class="text-secondary small fw-bold text-uppercase mb-1" style="letter-spacing: 1px;">Consolas</div>
                                <h3 class="fw-bold text-white display-5 mb-0" th:text="${consolesCount}">0</h3>
                            </div>
                        </div>

                        <div class="row g-3 mb-4 px-2">
                            <div class="col-md-6 text-center text-md-start">
                                <label class="text-secondary x-small fw-bold text-uppercase">Nombre de Usuario</label>
                                <div class="fs-5 text-white fw-bold" th:text="${user.username}">User</div>
                            </div>
                            <div class="col-md-6 text-center text-md-start">
                                <label class="text-secondary x-small fw-bold text-uppercase">Correo electrónico</label>
                                <div class="fs-5 text-white fw-bold text-truncate" 
                                     th:text="${isOwnProfile ? user.email : '********@****.com'}">email@test.com</div>
                            </div>
                        </div>

                        <form th:if="${isOwnProfile}" th:action="@{/profile/update}" method="post" enctype="multipart/form-data" class="mt-4">
                            <div th:if="${param.success}" class="alert alert-success bg-success text-white border-0 py-2 small mb-3">
                                <i class="bi bi-check-circle-fill me-1"></i> Foto de perfil actualizada correctamente.
                            </div>
                            <div class="p-4 rounded border border-secondary border-opacity-25" style="background-color: #0a0a0a;">
                                <label class="form-label text-val-red small fw-bold text-uppercase mb-3">
                                    <i class="bi bi-camera-fill me-1"></i> Actualizar Identificación Visual
                                </label>
                                <div class="input-group">
                                    <input type="file" name="avatar" class="form-control" accept="image/*">
                                    <button type="submit" class="btn val-btn-register text-uppercase fw-bold px-4">Subir</button>
                                </div>
                            </div>
                        </form>

                        <div th:if="${!isOwnProfile}" class="mt-4">
                            <form th:if="${!isFollowing}" th:action="@{/profile/follow/{id}(id=${user.id})}" method="post">
                                <button type="submit" class="btn val-btn-register w-100 text-uppercase fw-bold py-3 shadow-lg">
                                    <i class="bi bi-person-plus-fill me-2"></i> Seguir
                                </button>
                            </form>

                            <form th:if="${isFollowing}" th:action="@{/profile/unfollow/{id}(id=${user.id})}" method="post">
                                <button type="submit" class="btn btn-outline-secondary w-100 text-uppercase fw-bold py-3">
                                    <i class="bi bi-person-dash-fill me-2"></i> Dejar de Seguir
                                </button>
                            </form>
                        </div>

                    </div> 
                </div> 
            </div> 
        </div> 
    </div> 

    <div th:replace="~{fragments/footer :: footer}"></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>