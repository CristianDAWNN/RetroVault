<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: header}"></head>
<body>

    <div th:replace="~{fragments/nav :: navbar}"></div>

    <div class="container mt-5">
        <div class="row justify-content-center">
            
            <div class="col-lg-8">
                <div class="card bg-dark text-white border-secondary shadow-lg overflow-hidden">
                    
                    <div class="card-header border-0" style="background: linear-gradient(90deg, #3a0ca3, #f72585); height: 100px;"></div>
                    
                    <div class="card-body position-relative pt-0 px-4">
                        
                        <div class="text-center" style="margin-top: -75px;">
                            
                            <div class="position-relative d-inline-block">
                                <img th:if="${user.avatar != null}" th:src="@{'/uploads/avatars/' + ${user.avatar}}" 
                                     class="rounded-circle border border-4 border-dark shadow"
                                     style="width: 150px; height: 150px; object-fit: cover;">
                                     
                                <img th:if="${user.avatar == null}" src="https://cdn-icons-png.flaticon.com/512/847/847969.png" 
                                     class="rounded-circle border border-4 border-dark shadow"
                                     style="width: 150px; height: 150px; object-fit: cover; background: white;">
                            </div>
                            
                            <h2 class="mt-2 fw-bold text-white" th:text="${user.username}">Usuario</h2>

                            <div class="d-flex flex-column align-items-center justify-content-center mt-2 mb-2">
                                <span class="badge bg-warning text-dark border border-warning mb-2 fs-6">
                                    Nivel <span th:text="${user.level}">1</span>
                                </span>
                                
                                <div class="progress border border-secondary" style="width: 200px; height: 20px; background-color: #222;">
                                    <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                         role="progressbar" 
                                         th:style="'width: ' + ${user.getExpPercentage()} + '%; background-color: #f72585; box-shadow: 0 0 10px #f72585;'"
                                         th:aria-valuenow="${user.experience}" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100">
                                         
                                         <span style="font-size: 0.7rem; font-weight: bold; text-shadow: 1px 1px 2px black;">
                                            <span th:text="${user.experience}">0</span> / <span th:text="${user.getXpToNextLevel()}">100</span> XP
                                         </span>
                                    </div>
                                </div>
                            </div>

                            <p class="text-white-50 small mt-2">
                                Miembro desde <span th:text="${#temporals.format(user.createdAt, 'dd MMMM yyyy')}">Fecha</span>
                            </p>
                        </div>

                        <div class="row text-center mt-4 mb-4 p-3 rounded" style="background-color: rgba(0,0,0,0.2);">
                            
                            <div class="col-6 border-end border-secondary">
                                <div class="text-warning fw-bold mb-1" style="font-size: 0.9rem; letter-spacing: 1px;">
                                    JUEGOS
                                </div>
                                <h3 class="fw-bold text-white display-5 mb-0" th:text="${gamesCount}">0</h3>
                            </div>
                            
                            <div class="col-6">
                                <div class="text-info fw-bold mb-1" style="font-size: 0.9rem; letter-spacing: 1px;">
                                    CONSOLAS
                                </div>
                                <h3 class="fw-bold text-white display-5 mb-0" th:text="${consolesCount}">0</h3>
                            </div>
                            
                        </div>

                        <hr class="border-secondary">

                        <form th:action="@{/profile/update}" method="post" enctype="multipart/form-data" class="mt-4">
                            <div th:if="${param.success}" class="alert alert-success btn-sm">¡Foto actualizada!</div>

                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="text-secondary small">Nombre de Usuario</label>
                                    <div class="fs-5 text-white fw-bold" th:text="${user.username}">Usuario</div>
                                </div>
                                <div class="col-md-6">
                                    <label class="text-secondary small">Correo Electrónico</label>
                                    <div class="fs-5 text-white fw-bold" th:text="${user.email}">email@test.com</div>
                                </div>
                            </div>

                            <div class="mt-4 p-3 rounded bg-black bg-opacity-25 border border-secondary border-opacity-25">
                                <label class="form-label text-info small fw-bold">CAMBIAR FOTO DE PERFIL</label>
                                <div class="input-group">
                                    <input type="file" name="avatar" class="form-control bg-dark text-white border-secondary" accept="image/*">
                                    <button type="submit" class="btn btn-primary">Subir</button>
                                </div>
                            </div>
                        </form>

                    </div> </div> </div> </div> </div> <div th:replace="~{fragments/footer :: footer}"></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>